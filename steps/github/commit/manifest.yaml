apiVersion: stackpulse.io/v1
kind: Step
metadata:
  version: 1.0.0
  name: "github_open_pullrequest"
  description: "Create a pull-request to given repo by adding or modifying a single file."
  vendor: github
  type: remediation

envs:
  - name: TOKEN
    description: "GitHub API Token to access GitHub API."
    type: "string"
    required: true
    default: '{{ secret "GITHUB_TOKEN" }}'
    example: '{{ secret "GITHUB_TOKEN" }}'
  - name: REPO
    description: "Repository name for the pull request."
    type: "string"
    required: true
    example: "myorganization/myrepository"
  - name: NAME
    description: "Branch name for the pull request (prefixed by 'SP-Playbook')."
    type: "string"
    required: true
    example: "auto-generated-branch"
  - name: FILEPATH
    description: "File path in the repository to modify/create."
    type: "string"
    required: true
    example: "/path/to/myfile"
  - name: COMMANDS
    description: "Shell commands to execute. File content is passed as input. commands output is written back to the file."
    type: "string"
    required: true
    example: "sed -e 's/oldtext/newtext/'"
  - name: BASE
    description: "Base branch."
    type: "string"
    default: "master"
    example: "master"
  - name: TITLE
    description: "Pull request Title."
    type: "string"
    example: "StackPulse pull request"
  - name: BODY
    description: "Pull request body."
    type: "string"
    example: "This pull request was opened from StackPulse."
  - name: COMMIT_MSG
    description: "Commit Message."
    type: "string"
    example: "This commit was generated by StackPulse."

outputs:
  - name: url
    description: "Github's api url of the created pull request."
    type: string
    example: "https://api.github.com/repos/octocat/hello-world/pulls/1"
  - name: html_url
    description: "Github's url of the created pull request."
    type: string
    example: "https://github.com/octocat/Hello-World/pull/1"
  - name: created_at
    description: "Pull request creation date and time."
    type: string
    example: "2011-05-09T19:10:00Z"
  - name: title
    description: "Title of the created pull request."
    type: string
    example: "Edited README via GitHub"
  - name: number
    description: "Number of the pull request in said repository."
    type: int
    example: 1